
Demonstration on AWS CloudWatch
Objective
Through this demo you will learn how to Set up AWS CloudWatch Alarms to
monitor and get notifications for EC2 Instance CPU utilization.
Pre-requisites
• You must have a valid AWS account. You need to sign-in to the account.
• Ensure you have access to CloudWatch and EC2 service.
• An EC2 Instance, running on any AWS region. (A free-tier t2.micro instance)
Step1- Login to your AWS account and search for EC2 service and navigate to
Instance Dashboard page.
Launch a t2.micro instance, running Amazon Linux 2 AMI, and ensure you have
SSH access to the instance.
Step-2 Navigate to SNS service in the same region and create a SNS topic with an
email subscription, to receive email notifications sent by CloudWatch alarms.
SNS topic settings –
Standard SNS topic.
SNS topic Access policy to allow everyone to subscribe and publish.
Step-3 After creating the SNS topic, navigate back to EC2 Instance Dashboard
page, and go to monitoring tab.
Step-4 Under monitoring tab, for the CPU utilization, select the options and click
on View Metrics options, this will open the metrics on the CloudWatch service
page.
Step-5 Under the actions tab shown above, click on the bell icon, to create an
Alarm.
Click Here
Step-6 – Configuring the Alarm –
In Step 1 of alarm creation, specify metrics as shown below.
Statistics is set to Average.
Period is kept 1 minute.
Under conditions of Step 1, select threshold type to be “Static”, and whenever
CPU utilization is greater than 20 percent.
Here 20 is chosen for ease of simulation of CPU load, it can be set to any required
value. Click on Next to go to the next step of Alarm creation.
In Step 2 of Alarm creation, configure the actions.
Select Alarm stage trigger to be during “In Alarm”.
To send email notification, select the SNS topic created earlier, verify the email
subscription to the topic.
Rest all options in this is step are optional, click on Next to go the next step.
In the next step, provide the name and an optional description to the Alarm.
Click on Next to preview the Alarm settings and click on create to create the
Alarm.
Alarm created successfully –
Kindly note it will take a couple of minutes, for metrics to be populated in the
alarm.
Initially Alarm will be in “OK” state, as currently the EC2 instance is under no load.
Step-7 – Testing the Alarm
To test the alarm and the notification, simulate CPU load to the instance, for this
any load testing tool can be used.
For this demonstration a simple shell script, running an infinitely long while loop is
being used.
Script (for reference) –
#!/bin/bash
while :
do
echo "Do something; hit [CTRL+C] to stop!"
done
Create a script in the EC2 instance and run the script.
Upon execution of the script, the CPU utilization will increase beyond the
threshold set and the alarm will be triggered, and it will trigger a notification to
the subscribed endpoints in the SNS topic of the alarm.
It will take a couple of minutes, as the default resolution is 5 minutes.
Alarm triggered when CPU utilization was above threshold –
Email notification received –
This completes the demonstration on setting up a Cloud Watch alarm to trigger
notifications for EC2 Instance metrics.
Resource Cleanup –
To clean up the resources created,
1. Terminate the EC2 Instance.
2. Delete the CloudWatch Alarm, on the CloudWatch page-
3. Delete the SNS topic and subscription –